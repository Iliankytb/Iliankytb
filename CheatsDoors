local player = game.Players.LocalPlayer
local RunService = game:GetService("RunService")

-- Fonction pour créer des éléments UI
local function createUIElement(className, parent, properties)
    local element = Instance.new(className)
    element.Parent = parent
    for prop, value in pairs(properties) do
        element[prop] = value
    end
    return element
end

-- Supprimer l'ancien GUI si présent
local oldGui = player.PlayerGui:FindFirstChild("GuiPlayer")
if oldGui then
    oldGui:Destroy()
end

-- Création du GUI
local screenGui = createUIElement("ScreenGui", player.PlayerGui, { Name = "GuiPlayer", ResetOnSpawn = false })

-- Main Frame
local frame = createUIElement("Frame", screenGui, {
    Size = UDim2.new(0.25, 0, 0.75, 0),
    Position = UDim2.new(0.7, -90, 0.2, 0),
    BackgroundColor3 = Color3.fromRGB(60, 60, 60),
    BackgroundTransparency = 0.25,
    Visible = false
})

-- Gradient sur le Frame
createUIElement("UIGradient", frame, {
    Color = ColorSequence.new{
        ColorSequenceKeypoint.new(0, Color3.fromRGB(60, 60, 60)),
        ColorSequenceKeypoint.new(1, Color3.fromRGB(90, 90, 90))
    }
})

-- UI Stroke et Coin arrondi pour le Frame
createUIElement("UIStroke", frame, {
    Thickness = 3,
    Color = Color3.fromRGB(20, 20, 20),
    LineJoinMode = Enum.LineJoinMode.Round
})

createUIElement("UICorner", frame, { CornerRadius = UDim.new(0.1, 0) })

-- Bouton pour afficher/masquer le GUI
local toggleButton = createUIElement("TextButton", screenGui, {
    Size = UDim2.new(0, 100, 0, 25),
    Position = UDim2.new(0.9, -60, 0.2, 0),
    Text = "Toggle Menu",
    TextColor3 = Color3.fromRGB(255, 255, 255),
    Font = Enum.Font.GothamBold,
    TextSize = 18,
    BackgroundColor3 = Color3.fromRGB(85, 170, 255)
})

-- Sidebar Frame à gauche
local sidebarFrame = createUIElement("Frame", screenGui, {
    Size = UDim2.new(0.2, 0, 0.75, 0),
    Position = UDim2.new(0.5, -90, 0.2, 0),
    BackgroundColor3 = Color3.fromRGB(40, 40, 40),
    BackgroundTransparency = 0.25,
    Visible = false
})

-- Scrolling Frame dans sidebar
local sidebarScrollingFrame = createUIElement("ScrollingFrame", sidebarFrame, {
    Size = UDim2.new(1, 0, 1, 0),
    CanvasSize = UDim2.new(0, 0, 0, 800),
    ScrollBarThickness = 8,
    BackgroundTransparency = 1
})

-- Frame des boutons ESP
local scrollingframeEsp = createUIElement("ScrollingFrame", frame, {
    Size = UDim2.new(1, 0, 1, 0),
    CanvasSize = UDim2.new(0, 0, 0, 800),
    ScrollBarThickness = 8,
    BackgroundTransparency = 1,
    Visible = false
})

-- Main Scrolling Frame
local scrollingFrame = createUIElement("ScrollingFrame", frame, {
    Size = UDim2.new(1, 0, 1, 0),
    CanvasSize = UDim2.new(0, 0, 0, 800),
    ScrollBarThickness = 8,
    BackgroundTransparency = 1
})

-- Fonction pour créer des boutons
local function createButton(text, parent)
    local button = createUIElement("TextButton", parent, {
        Size = UDim2.new(0.90, 0, 0, 50),
        Text = text,
        TextColor3 = Color3.fromRGB(255, 255, 255),
        Font = Enum.Font.GothamBold,
        TextSize = 16,
        BackgroundColor3 = Color3.fromRGB(50, 50, 50)
    })

    -- Gradient sur chaque bouton
    createUIElement("UIGradient", button, {
        Color = ColorSequence.new{
            ColorSequenceKeypoint.new(0, Color3.fromRGB(70, 70, 70)),
            ColorSequenceKeypoint.new(1, Color3.fromRGB(100, 100, 100))
        }
    })

    createUIElement("UIStroke", button, {
        Thickness = 2,
        Color = Color3.fromRGB(20, 20, 20),
        LineJoinMode = Enum.LineJoinMode.Round
    })

    createUIElement("UICorner", button, { CornerRadius = UDim.new(0.1, 0) })

    return button
end

-- UIListLayout pour organiser les boutons dans le frame principal et le scrolling ESP
createUIElement("UIListLayout", sidebarScrollingFrame, {
    SortOrder = Enum.SortOrder.LayoutOrder,
    Padding = UDim.new(0, 10)
})

createUIElement("UIListLayout", scrollingFrame, {
    SortOrder = Enum.SortOrder.LayoutOrder,
    Padding = UDim.new(0, 10)
})

createUIElement("UIListLayout", scrollingframeEsp, {
    SortOrder = Enum.SortOrder.LayoutOrder,
    Padding = UDim.new(0, 10)
})

-- Boutons dans la sidebar
createButton("Main", sidebarScrollingFrame)
createButton("ESP", sidebarScrollingFrame)
createButton("Player", sidebarScrollingFrame)
createButton("Give Item", sidebarScrollingFrame)
createButton("Information", sidebarScrollingFrame)
local removeGuiButton = createButton("Remove UI", sidebarScrollingFrame)

-- ESP boutons
createButton("Esp Player", scrollingframeEsp)

-- Ajout des nouveaux boutons dans scrollingFrame (Main)
createButton("Full Bright", scrollingFrame)
createButton("No Cooldown Prompt", scrollingFrame)
createButton("Auto Prompt", scrollingFrame)
createButton("ESP Off", scrollingFrame)
createButton("No Lag", scrollingFrame)

-- Fonctionnalité ESP
local espActive = false
local espTargets = {}

local FullBrightActive = false

-- Fonction pour activer/désactiver FullBright
local function toggleFullBright()
    FullBrightActive = not FullBrightActive
    game.Lighting.Brightness = FullBrightActive and 100 or 1
end

scrollingFrame:WaitForChild("Full Bright").MouseButton1Click:Connect(function()
    toggleFullBright()
end)

-- Fonctionnalité ESP pour voir les joueurs
local function highlightPlayers()
    espTargets = {}
    for _, player in pairs(game.Players:GetPlayers()) do
        local char = player.Character
        local humanoidRootPart = char and char:FindFirstChild("HumanoidRootPart")
        if humanoidRootPart then
            highlightModel(char)
            table.insert(espTargets, char)
        end
    end
end

-- Fonction pour trouver tous les ProximityPrompt dans un objet
local function findProximityPrompts(parent)
    local prompts = {}
    for _, child in pairs(parent:GetChildren()) do
        if child:IsA("ProximityPrompt") then
            table.insert(prompts, child)
        elseif child:IsA("Model") or child:IsA("Folder") then
            local subPrompts = findProximityPrompts(child)
            for _, prompt in pairs(subPrompts) do
                table.insert(prompts, prompt)
            end
        end
    end
    return prompts
end

-- Fonction pour activer "No Lag"
local originalMaterials = {}

local function activateNoLag()
    for _, part in pairs(workspace:GetDescendants()) do
        if part:IsA("BasePart") then
            originalMaterials[part] = part.Material
            part.Material = Enum.Material.SmoothPlastic
        end
    end
end

local function restoreMaterials()
    for part, material in pairs(originalMaterials) do
        if part and part:IsA("BasePart") then
            part.Material = material
        end
    end
    originalMaterials = {}
end

scrollingFrame:WaitForChild("No Lag").MouseButton1Click:Connect(function()
    if next(originalMaterials) == nil then
        activateNoLag()
    else
        restoreMaterials()
    end
end)

-- Fonction pour ajouter un effet de surbrillance
local function highlightModel(model)
    if not model:FindFirstChildOfClass("Highlight") then
        local highlight = createUIElement("Highlight", model, {
            FillColor = Color3.fromRGB(255, 0, 0),
            OutlineColor = Color3.fromRGB(255, 255, 255),
            FillTransparency = 0.5,
            OutlineTransparency = 0
        })
    end
end

toggleButton.MouseButton1Click:Connect(function()
    frame.Visible = not frame.Visible
    sidebarFrame.Visible = not sidebarFrame.Visible
end)

-- Gérer le bouton "Remove UI"
removeGuiButton.MouseButton1Click:Connect(function()
    if screenGui then
        screenGui:Destroy()
    end
end)

-- Gestion de l'affichage/masquage des différentes sections du GUI
local function switchToSection(sectionName)
    scrollingFrame.Visible = (sectionName == "Main")
    scrollingframeEsp.Visible = (sectionName == "ESP")
    -- Vous pouvez ajouter d'autres sections ici, par exemple pour "Player" ou "Give Item"
end

-- Associer les boutons de la sidebar aux sections
sidebarScrollingFrame:WaitForChild("Main").MouseButton1Click:Connect(function()
    switchToSection("Main")
end)

sidebarScrollingFrame:WaitForChild("ESP").MouseButton1Click:Connect(function()
    switchToSection("ESP")
end)

-- Fonction pour désactiver ESP
scrollingFrame:WaitForChild("ESP Off").MouseButton1Click:Connect(function()
    for _, target in pairs(espTargets) do
        if target and target:FindFirstChildOfClass("Highlight") then
            target:FindFirstChildOfClass("Highlight"):Destroy()
        end
    end
    espTargets = {}
end)

-- Gérer le bouton pour activer l'ESP
scrollingframeEsp:WaitForChild("Esp Player").MouseButton1Click:Connect(function()
    highlightPlayers()
end)

-- Le script est maintenant terminé.
