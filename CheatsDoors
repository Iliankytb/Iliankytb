local player = game.Players.LocalPlayer
local RunService = game:GetService("RunService")

-- Supprimer l'ancien GUI si présent
if player.PlayerGui:FindFirstChild("GuiPlayer") then
    player.PlayerGui.GuiPlayer:Destroy()
end

-- Création du GUI
local screenGui = Instance.new("ScreenGui", player.PlayerGui)
screenGui.Name = "GuiPlayer"
screenGui.ResetOnSpawn = false

-- Main Frame
local frame = Instance.new("Frame", screenGui)
frame.Size = UDim2.new(0.25, 0, 0.75, 0)
frame.Position = UDim2.new(0.7, -90, 0.2, 0)
frame.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
frame.BackgroundTransparency = 0.25
frame.Visible = false

-- Gradient sur le Frame
local gradient = Instance.new("UIGradient", frame)
gradient.Color = ColorSequence.new{
    ColorSequenceKeypoint.new(0, Color3.fromRGB(60, 60, 60)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(90, 90, 90))
}

-- UI Stroke et Coin arrondi pour le Frame
local uistroke = Instance.new("UIStroke", frame)
uistroke.Thickness = 3
uistroke.Color = Color3.fromRGB(20, 20, 20)
uistroke.LineJoinMode = Enum.LineJoinMode.Round

local uicorner = Instance.new("UICorner", frame)
uicorner.CornerRadius = UDim.new(0.1, 0)

-- Bouton pour afficher/masquer le GUI
local toggleButton = Instance.new("TextButton", screenGui)
toggleButton.Size = UDim2.new(0, 100, 0, 25)
toggleButton.Position = UDim2.new(0.9, -60, 0.2, 0)
toggleButton.Text = "Toggle Menu"
toggleButton.TextColor3 = Color3.fromRGB(255, 255, 255)
toggleButton.Font = Enum.Font.GothamBold
toggleButton.TextSize = 18
toggleButton.BackgroundColor3 = Color3.fromRGB(85, 170, 255)

-- Sidebar Frame à gauche
local sidebarFrame = Instance.new("Frame", screenGui)
sidebarFrame.Size = UDim2.new(0.2, 0, 0.75, 0)
sidebarFrame.Position = UDim2.new(0.5, -90, 0.2, 0)
sidebarFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
sidebarFrame.BackgroundTransparency = 0.25
sidebarFrame.Visible = false

-- Scrolling Frame dans sidebar
local sidebarScrollingFrame = Instance.new("ScrollingFrame", sidebarFrame)
sidebarScrollingFrame.Size = UDim2.new(1, 0, 1, 0)
sidebarScrollingFrame.CanvasSize = UDim2.new(0, 0, 0, 800)
sidebarScrollingFrame.ScrollBarThickness = 8
sidebarScrollingFrame.BackgroundTransparency = 1

-- Frame des boutons ESP
local scrollingframeEsp = Instance.new("ScrollingFrame", frame)
scrollingframeEsp.Size = UDim2.new(1, 0, 1, 0)
scrollingframeEsp.CanvasSize = UDim2.new(0, 0, 0, 800)
scrollingframeEsp.ScrollBarThickness = 8
scrollingframeEsp.BackgroundTransparency = 1
scrollingframeEsp.Visible = false

-- Main Scrolling Frame
local scrollingFrame = Instance.new("ScrollingFrame", frame)
scrollingFrame.Size = UDim2.new(1, 0, 1, 0)
scrollingFrame.CanvasSize = UDim2.new(0, 0, 0, 800)
scrollingFrame.ScrollBarThickness = 8
scrollingFrame.BackgroundTransparency = 1

-- Fonction pour créer des boutons
local function createButton(text, parent)
    local button = Instance.new("TextButton", parent)
    button.Size = UDim2.new(0.90, 0, 0, 50)
    button.Text = text
    button.TextColor3 = Color3.fromRGB(255, 255, 255)
    button.Font = Enum.Font.GothamBold
    button.TextSize = 16
    button.BackgroundColor3 = Color3.fromRGB(50, 50, 50)

    -- Gradient sur chaque bouton
    local buttonGradient = Instance.new("UIGradient", button)
    buttonGradient.Color = ColorSequence.new{
        ColorSequenceKeypoint.new(0, Color3.fromRGB(70, 70, 70)),
        ColorSequenceKeypoint.new(1, Color3.fromRGB(100, 100, 100))
    }

    local buttonStroke = uistroke:Clone()
    buttonStroke.Parent = button

    local buttonCorner = uicorner:Clone()
    buttonCorner.Parent = button

    return button
end

-- UIListLayout pour organiser les boutons dans le frame principal et le scrolling ESP
local sidebarListLayout = Instance.new("UIListLayout", sidebarScrollingFrame)
sidebarListLayout.SortOrder = Enum.SortOrder.LayoutOrder
sidebarListLayout.Padding = UDim.new(0, 10)

local frameListLayout = Instance.new("UIListLayout", scrollingFrame)
frameListLayout.SortOrder = Enum.SortOrder.LayoutOrder
frameListLayout.Padding = UDim.new(0, 10)

local espListLayout = Instance.new("UIListLayout", scrollingframeEsp)
espListLayout.SortOrder = Enum.SortOrder.LayoutOrder
espListLayout.Padding = UDim.new(0, 10)

-- Boutons dans la sidebar
local mainButton = createButton("Main", sidebarScrollingFrame)
local EspButton = createButton("ESP", sidebarScrollingFrame)
local PlayerButton = createButton("Player", sidebarScrollingFrame)
local GiveItemButton = createButton("Give Item", sidebarScrollingFrame)
local InfoButton = createButton("Information", sidebarScrollingFrame)
local RemoveGuiButton = createButton("Remove UI", sidebarScrollingFrame)

-- ESP bouton
local espButton = createButton("ESP Off", scrollingframeEsp)

-- Ajout des nouveaux boutons dans scrollingFrame (Main)
local fullBrightButton = createButton("Full Bright", scrollingFrame)
local noCooldownButton = createButton("No Cooldown Prompt", scrollingFrame)
local autoPromptButton = createButton("Auto Prompt", scrollingFrame)
local espDoorButton = createButton("ESP Door", scrollingFrame) -- Renommé de ESO Door

-- Ajout du bouton "No Lag"
local noLagButton = createButton("No Lag", scrollingFrame)

-- Ajout des nouveaux boutons dans scrollingFrame ESP
local espPlayerButton = createButton("Voir Joueurs", scrollingframeEsp)

-- Fonctionnalité ESP
local espActive = false
local espTargets = {}

-- Fonction pour activer FullBright
local function activateFullBright()
    game.Lighting.Brightness = 2
    game.Lighting.ClockTime = 14
end

fullBrightButton.MouseButton1Click:Connect(activateFullBright)

-- Fonctionnalité ESP pour voir les joueurs
local function highlightPlayers()
    for _, player in pairs(game.Players:GetPlayers()) do
        local char = player.Character
        if char and char:FindFirstChild("HumanoidRootPart") then
            highlightModel(char)
        end
    end
end

espPlayerButton.MouseButton1Click:Connect(highlightPlayers)

-- Fonction pour réduire les lags (No Lag)
local originalMaterials = {}

local function activateNoLag()
    for _, part in pairs(workspace:GetDescendants()) do
        if part:IsA("BasePart") then
            originalMaterials[part] = part.Material
            part.Material = Enum.Material.SmoothPlastic
        end
    end
end

local function restoreMaterials()
    for part, material in pairs(originalMaterials) do
        if part and part:IsA("BasePart") then
            part.Material = material
        end
    end
    originalMaterials = {}
end

noLagButton.MouseButton1Click:Connect(function()
    if next(originalMaterials) == nil then
        activateNoLag()
    else
        restoreMaterials()
    end
end)

-- Toggle ESP
espButton.MouseButton1Click:Connect(function()
    espActive = not espActive
    if espActive then
        updateEspTargets()
        highlightModels()
        espButton.Text = "ESP On"
    else
        clearHighlights()
        espButton.Text = "ESP Off"
    end
end)

-- Toggle pour afficher/masquer le GUI
local function toggleFrame()
    frame.Visible = not frame.Visible
    sidebarFrame.Visible = not sidebarFrame.Visible
end

toggleButton.MouseButton1Click:Connect(toggleFrame)

-- Navigation entre les frames
EspButton.MouseButton1Click:Connect(function()
    scrollingframeEsp.Visible = true
    scrollingFrame.Visible = false
end)

mainButton.MouseButton1Click:Connect(function()
    scrollingFrame.Visible = true
    scrollingframeEsp.Visible = false
end)

-- Boucle de mise à jour continue
RunService.RenderStepped:Connect(function()
        if espActive then
        updateEspTargets()
        highlightModels()
    else
        clearHighlights()
    end
end)

-- Bouton pour supprimer le GUI
RemoveGuiButton.MouseButton1Click:Connect(function()
    screenGui:Destroy()
end)

-- Fonction pour mettre à jour les cibles ESP
function updateEspTargets()
    espTargets = {}
    for _, player in pairs(game.Players:GetPlayers()) do
        if player ~= game.Players.LocalPlayer then
            table.insert(espTargets, player.Character)
        end
    end
end

-- Fonction pour ajouter les contours ESP
function highlightModels()
    for _, model in pairs(espTargets) do
        if model and model:FindFirstChild("HumanoidRootPart") then
            highlightModel(model)
        end
    end
end

-- Fonction pour ajouter un effet de surbrillance
function highlightModel(model)
    local highlight = Instance.new("Highlight", model)
    highlight.FillColor = Color3.fromRGB(255, 0, 0)
    highlight.OutlineColor = Color3.fromRGB(255, 255, 255)
    highlight.FillTransparency = 0.5
    highlight.OutlineTransparency = 0
end

-- Fonction pour supprimer tous les highlights
function clearHighlights()
    for _, player in pairs(game.Players:GetPlayers()) do
        local char = player.Character
        if char and char:FindFirstChildOfClass("Highlight") then
            char:FindFirstChildOfClass("Highlight"):Destroy()
        end
    end
end
